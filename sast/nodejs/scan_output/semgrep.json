{
  "version": "1.119.0",
  "results": [
    {
      "check_id": "javascript.express.log.console-log-express.console-log-express",
      "path": "RouterClientLogger.ts",
      "start": {
        "line": 12,
        "col": 9,
        "offset": 411
      },
      "end": {
        "line": 12,
        "col": 121,
        "offset": 523
      },
      "extra": {
        "metavars": {
          "$EXPRESS": {
            "start": {
              "line": 10,
              "col": 36,
              "offset": 278
            },
            "end": {
              "line": 10,
              "col": 43,
              "offset": 285
            },
            "abstract_content": "express"
          },
          "$REQ": {
            "start": {
              "line": 12,
              "col": 57,
              "offset": 459
            },
            "end": {
              "line": 12,
              "col": 60,
              "offset": 462
            },
            "abstract_content": "req"
          }
        },
        "message": "Detected a logger that logs user input without properly neutralizing the output. The log message could contain characters like ` ` and ` ` and cause an attacker to forge log entries or include malicious content into the logs. Use proper input validation and/or output encoding to prevent log entries from being forged.",
        "metadata": {
          "likelihood": "LOW",
          "impact": "LOW",
          "confidence": "HIGH",
          "category": "security",
          "subcategory": [
            "vuln"
          ],
          "cwe": [
            "CWE-117: Improper Output Neutralization for Logs"
          ],
          "display-name": "Log Injection with Express",
          "functional-categories": [
            "log::sink::log::javascript",
            "web::source::cookie::express",
            "web::source::form-data::express",
            "web::source::header::express",
            "web::source::http-body::express",
            "web::source::url-path-params::express",
            "web::source::url-query-string::express"
          ],
          "owasp": [
            "A09:2021 - Security Logging and Monitoring Failures"
          ],
          "references": [
            "https://owasp.org/Top10/A09_2021-Security_Logging_and_Monitoring_Failures"
          ],
          "technology": [
            "express",
            "web"
          ],
          "license": "Semgrep Rules License v1.0. For more details, visit semgrep.dev/legal/rules-license",
          "vulnerability_class": [
            "Improper Validation"
          ],
          "source": "https://semgrep.dev/r/javascript.express.log.console-log-express.console-log-express",
          "shortlink": "https://sg.run/pK7Ok",
          "semgrep.dev": {
            "rule": {
              "origin": "pro_rules",
              "r_id": 156118,
              "rule_id": "x8UKzE2",
              "rv_id": 1041972,
              "url": "https://semgrep.dev/playground/r/YDT2YlA/javascript.express.log.console-log-express.console-log-express",
              "version_id": "YDT2YlA"
            }
          }
        },
        "severity": "INFO",
        "fingerprint": "7832d76f4569cfb276ad431182e6d0ec54f6f7fe04447fba51db9bfa571c5e911f56b8b9c9b15e8410cf487e71d9e7633d2ef1c416bcd57a18d17a37ca5eb7db_0",
        "lines": "        console.info(`Incoming request: ${req.method} ${req.url}  user=${isSignup ? ``: req.headers['x-user-session']}`);",
        "is_ignored": false,
        "validation_state": "NO_VALIDATOR",
        "dataflow_trace": {
          "taint_source": [
            "CliLoc",
            [
              {
                "path": "RouterClientLogger.ts",
                "start": {
                  "line": 12,
                  "col": 57,
                  "offset": 459
                },
                "end": {
                  "line": 12,
                  "col": 60,
                  "offset": 462
                }
              },
              "req"
            ]
          ],
          "intermediate_vars": [
            {
              "location": {
                "path": "RouterClientLogger.ts",
                "start": {
                  "line": 12,
                  "col": 22,
                  "offset": 424
                },
                "end": {
                  "line": 12,
                  "col": 23,
                  "offset": 425
                }
              },
              "content": "`"
            }
          ],
          "taint_sink": [
            "CliLoc",
            [
              {
                "path": "RouterClientLogger.ts",
                "start": {
                  "line": 12,
                  "col": 9,
                  "offset": 411
                },
                "end": {
                  "line": 12,
                  "col": 121,
                  "offset": 523
                }
              },
              "console.info(`Incoming request: ${req.method} ${req.url}  user=${isSignup ? ``: req.headers['x-user-session']}`)"
            ]
          ]
        },
        "engine_kind": "OSS"
      }
    },
    {
      "check_id": "custom_rules.detect-bracket-object-injection",
      "path": "src/server/ai/assistants/Assistant.ts.ts",
      "start": {
        "line": 55,
        "col": 13,
        "offset": 2027
      },
      "end": {
        "line": 55,
        "col": 66,
        "offset": 2080
      },
      "extra": {
        "metavars": {
          "$VAR": {
            "start": {
              "line": 55,
              "col": 19,
              "offset": 2033
            },
            "end": {
              "line": 55,
              "col": 36,
              "offset": 2050
            },
            "abstract_content": "lastThreadMessage"
          },
          "$OBJ": {
            "start": {
              "line": 55,
              "col": 39,
              "offset": 2053
            },
            "end": {
              "line": 55,
              "col": 63,
              "offset": 2077
            },
            "abstract_content": "messagesRes.payload.data"
          },
          "$FIELD": {
            "start": {
              "line": 55,
              "col": 64,
              "offset": 2078
            },
            "end": {
              "line": 55,
              "col": 65,
              "offset": 2079
            },
            "abstract_content": "0"
          }
        },
        "message": "Object injection via bracket notation via 0\n",
        "metadata": {
          "likelihood": "HIGH",
          "impact": "HIGH",
          "confidence": "MEDIUM",
          "category": "security",
          "cwe": [
            "CWE-20: Improper Input Validation"
          ],
          "owasp": [
            "A03:2021 - Injection"
          ],
          "references": [
            "https://cwe.mitre.org/data/definitions/20.html",
            "https://owasp.org/Top10/A03_2021-Injection"
          ]
        },
        "severity": "WARNING",
        "fingerprint": "b1ccd72a5fe62b8e7641503b3372707df9f81a5bf9b03ed6f3af38747197357c3cdaabd150dd520efe341efb5b44b1588761a489f5b3d89c6dcf306fe15ed791_0",
        "lines": "            const lastThreadMessage = messagesRes.payload.data[0];",
        "is_ignored": false,
        "validation_state": "NO_VALIDATOR",
        "engine_kind": "OSS"
      }
    },
    {
      "check_id": "custom_rules.detect-bracket-object-injection",
      "path": "src/server/ai/assistants/Assistant.ts.ts",
      "start": {
        "line": 56,
        "col": 13,
        "offset": 2094
      },
      "end": {
        "line": 56,
        "col": 72,
        "offset": 2153
      },
      "extra": {
        "metavars": {
          "$VAR": {
            "start": {
              "line": 56,
              "col": 19,
              "offset": 2100
            },
            "end": {
              "line": 56,
              "col": 42,
              "offset": 2123
            },
            "abstract_content": "secondLastThreadMessage"
          },
          "$OBJ": {
            "start": {
              "line": 56,
              "col": 45,
              "offset": 2126
            },
            "end": {
              "line": 56,
              "col": 69,
              "offset": 2150
            },
            "abstract_content": "messagesRes.payload.data"
          },
          "$FIELD": {
            "start": {
              "line": 56,
              "col": 70,
              "offset": 2151
            },
            "end": {
              "line": 56,
              "col": 71,
              "offset": 2152
            },
            "abstract_content": "1"
          }
        },
        "message": "Object injection via bracket notation via 1\n",
        "metadata": {
          "likelihood": "HIGH",
          "impact": "HIGH",
          "confidence": "MEDIUM",
          "category": "security",
          "cwe": [
            "CWE-20: Improper Input Validation"
          ],
          "owasp": [
            "A03:2021 - Injection"
          ],
          "references": [
            "https://cwe.mitre.org/data/definitions/20.html",
            "https://owasp.org/Top10/A03_2021-Injection"
          ]
        },
        "severity": "WARNING",
        "fingerprint": "4784bae692560f93d3fe30dd5ced8fbf68c941159446253e65f764b1b1d6f2336be46f8e3cf015c227576efafdcd3df15438fbbbc1925ef5f71494f837b366a2_0",
        "lines": "            const secondLastThreadMessage = messagesRes.payload.data[1];",
        "is_ignored": false,
        "validation_state": "NO_VALIDATOR",
        "engine_kind": "OSS"
      }
    },
    {
      "check_id": "custom_rules.detect-bracket-object-injection",
      "path": "src/server/api/utils/HttpRequestUtils.ts",
      "start": {
        "line": 59,
        "col": 13,
        "offset": 1631
      },
      "end": {
        "line": 59,
        "col": 40,
        "offset": 1658
      },
      "extra": {
        "metavars": {
          "$VAR": {
            "start": {
              "line": 59,
              "col": 19,
              "offset": 1637
            },
            "end": {
              "line": 59,
              "col": 28,
              "offset": 1646
            },
            "abstract_content": "character"
          },
          "$OBJ": {
            "start": {
              "line": 59,
              "col": 31,
              "offset": 1649
            },
            "end": {
              "line": 59,
              "col": 37,
              "offset": 1655
            },
            "abstract_content": "header"
          },
          "$FIELD": {
            "start": {
              "line": 59,
              "col": 38,
              "offset": 1656
            },
            "end": {
              "line": 59,
              "col": 39,
              "offset": 1657
            },
            "abstract_content": "i"
          }
        },
        "message": "Object injection via bracket notation via i\n",
        "metadata": {
          "likelihood": "HIGH",
          "impact": "HIGH",
          "confidence": "MEDIUM",
          "category": "security",
          "cwe": [
            "CWE-20: Improper Input Validation"
          ],
          "owasp": [
            "A03:2021 - Injection"
          ],
          "references": [
            "https://cwe.mitre.org/data/definitions/20.html",
            "https://owasp.org/Top10/A03_2021-Injection"
          ]
        },
        "severity": "WARNING",
        "fingerprint": "1c3aec055cb28e19259a714daa65d42483ee495d988676828de8c96b6f2d5280b6130d71c88e1d0e83bb6c09b4f955cc1b47e12c0d66c9063483135b70b44ac7_0",
        "lines": "            const character = header[i];",
        "is_ignored": false,
        "validation_state": "NO_VALIDATOR",
        "engine_kind": "OSS"
      }
    },
    {
      "check_id": "javascript.lang.security.audit.unsafe-formatstring.unsafe-formatstring",
      "path": "src/server/utils/JsonLogger.ts",
      "start": {
        "line": 7,
        "col": 21,
        "offset": 283
      },
      "end": {
        "line": 7,
        "col": 64,
        "offset": 326
      },
      "extra": {
        "metavars": {
          "$LOG": {
            "start": {
              "line": 7,
              "col": 17,
              "offset": 279
            },
            "end": {
              "line": 7,
              "col": 20,
              "offset": 282
            },
            "abstract_content": "log"
          },
          "$STR": {
            "start": {
              "line": 7,
              "col": 21,
              "offset": 283
            },
            "end": {
              "line": 7,
              "col": 64,
              "offset": 326
            },
            "abstract_content": "`[key??JsonLogger.DEFAULT_LOG_KEY]:   "
          },
          "$PARAM": {
            "start": {
              "line": 7,
              "col": 67,
              "offset": 329
            },
            "end": {
              "line": 7,
              "col": 97,
              "offset": 359
            },
            "abstract_content": "JSON.stringify(input null 2)"
          }
        },
        "message": "Detected string concatenation with a non-literal variable in a util.format / console.log function. If an attacker injects a format specifier in the string, it will forge the log message. Try to use constant values for the format string.",
        "metadata": {
          "cwe": [
            "CWE-134: Use of Externally-Controlled Format String"
          ],
          "owasp": [
            "A01:2021 - Broken Access Control"
          ],
          "category": "security",
          "technology": [
            "javascript"
          ],
          "subcategory": [
            "audit"
          ],
          "likelihood": "MEDIUM",
          "impact": "LOW",
          "confidence": "LOW",
          "references": [
            "https://cwe.mitre.org/data/definitions/134.html"
          ],
          "license": "Semgrep Rules License v1.0. For more details, visit semgrep.dev/legal/rules-license",
          "vulnerability_class": [
            "Improper Validation"
          ],
          "source": "https://semgrep.dev/r/javascript.lang.security.audit.unsafe-formatstring.unsafe-formatstring",
          "shortlink": "https://sg.run/7Y5R",
          "semgrep.dev": {
            "rule": {
              "origin": "community",
              "r_id": 13582,
              "rule_id": "ReU3OJ",
              "rv_id": 945885,
              "url": "https://semgrep.dev/playground/r/1QToKA3/javascript.lang.security.audit.unsafe-formatstring.unsafe-formatstring",
              "version_id": "1QToKA3"
            }
          }
        },
        "severity": "INFO",
        "fingerprint": "999302491cbb026485e103c1bb7d6d6630d6efffae6e2cbc6074fb0bcfe5edc27f709bc2208d749aadac96af345afdcd528d598b4a8851d6c84e8beccd06a094_0",
        "lines": "        console.log(`[${key ?? JsonLogger.DEFAULT_LOG_KEY}]:   `, JSON.stringify(input, null, 2));",
        "is_ignored": false,
        "validation_state": "NO_VALIDATOR",
        "dataflow_trace": {
          "taint_source": [
            "CliLoc",
            [
              {
                "path": "src/server/utils/JsonLogger.ts",
                "start": {
                  "line": 7,
                  "col": 21,
                  "offset": 283
                },
                "end": {
                  "line": 7,
                  "col": 64,
                  "offset": 326
                }
              },
              "`[${key ?? JsonLogger.DEFAULT_LOG_KEY}]:   "
            ]
          ],
          "intermediate_vars": [],
          "taint_sink": [
            "CliLoc",
            [
              {
                "path": "src/server/utils/JsonLogger.ts",
                "start": {
                  "line": 7,
                  "col": 21,
                  "offset": 283
                },
                "end": {
                  "line": 7,
                  "col": 64,
                  "offset": 326
                }
              },
              "`[${key ?? JsonLogger.DEFAULT_LOG_KEY}]:   "
            ]
          ]
        },
        "engine_kind": "OSS"
      }
    },
    {
      "check_id": "javascript.lang.security.audit.unsafe-formatstring.unsafe-formatstring",
      "path": "src/server/utils/JsonLogger.ts",
      "start": {
        "line": 13,
        "col": 21,
        "offset": 567
      },
      "end": {
        "line": 13,
        "col": 64,
        "offset": 610
      },
      "extra": {
        "metavars": {
          "$LOG": {
            "start": {
              "line": 13,
              "col": 17,
              "offset": 563
            },
            "end": {
              "line": 13,
              "col": 20,
              "offset": 566
            },
            "abstract_content": "log"
          },
          "$STR": {
            "start": {
              "line": 13,
              "col": 21,
              "offset": 567
            },
            "end": {
              "line": 13,
              "col": 64,
              "offset": 610
            },
            "abstract_content": "`[key??JsonLogger.DEFAULT_LOG_KEY]:   "
          },
          "$PARAM": {
            "start": {
              "line": 13,
              "col": 67,
              "offset": 613
            },
            "end": {
              "line": 13,
              "col": 84,
              "offset": 630
            },
            "abstract_content": "JSON.parse(input)"
          }
        },
        "message": "Detected string concatenation with a non-literal variable in a util.format / console.log function. If an attacker injects a format specifier in the string, it will forge the log message. Try to use constant values for the format string.",
        "metadata": {
          "cwe": [
            "CWE-134: Use of Externally-Controlled Format String"
          ],
          "owasp": [
            "A01:2021 - Broken Access Control"
          ],
          "category": "security",
          "technology": [
            "javascript"
          ],
          "subcategory": [
            "audit"
          ],
          "likelihood": "MEDIUM",
          "impact": "LOW",
          "confidence": "LOW",
          "references": [
            "https://cwe.mitre.org/data/definitions/134.html"
          ],
          "license": "Semgrep Rules License v1.0. For more details, visit semgrep.dev/legal/rules-license",
          "vulnerability_class": [
            "Improper Validation"
          ],
          "source": "https://semgrep.dev/r/javascript.lang.security.audit.unsafe-formatstring.unsafe-formatstring",
          "shortlink": "https://sg.run/7Y5R",
          "semgrep.dev": {
            "rule": {
              "origin": "community",
              "r_id": 13582,
              "rule_id": "ReU3OJ",
              "rv_id": 945885,
              "url": "https://semgrep.dev/playground/r/1QToKA3/javascript.lang.security.audit.unsafe-formatstring.unsafe-formatstring",
              "version_id": "1QToKA3"
            }
          }
        },
        "severity": "INFO",
        "fingerprint": "52bc719272eabbbac0bf4a24e4c99546746c276588c42183c18cd03eb2613d81b3c69871079c0b5c543038d9ccc1649e8e5073f4b0a6ea7c6a508adb43ce22f4_0",
        "lines": "        console.log(`[${key ?? JsonLogger.DEFAULT_LOG_KEY}]:   `, JSON.parse(input));",
        "is_ignored": false,
        "validation_state": "NO_VALIDATOR",
        "dataflow_trace": {
          "taint_source": [
            "CliLoc",
            [
              {
                "path": "src/server/utils/JsonLogger.ts",
                "start": {
                  "line": 13,
                  "col": 21,
                  "offset": 567
                },
                "end": {
                  "line": 13,
                  "col": 64,
                  "offset": 610
                }
              },
              "`[${key ?? JsonLogger.DEFAULT_LOG_KEY}]:   "
            ]
          ],
          "intermediate_vars": [],
          "taint_sink": [
            "CliLoc",
            [
              {
                "path": "src/server/utils/JsonLogger.ts",
                "start": {
                  "line": 13,
                  "col": 21,
                  "offset": 567
                },
                "end": {
                  "line": 13,
                  "col": 64,
                  "offset": 610
                }
              },
              "`[${key ?? JsonLogger.DEFAULT_LOG_KEY}]:   "
            ]
          ]
        },
        "engine_kind": "OSS"
      }
    },
    {
      "check_id": "javascript.lang.security.audit.unsafe-formatstring.unsafe-formatstring",
      "path": "src/server/utils/JsonLogger.ts",
      "start": {
        "line": 20,
        "col": 25,
        "offset": 880
      },
      "end": {
        "line": 20,
        "col": 68,
        "offset": 923
      },
      "extra": {
        "metavars": {
          "$LOG": {
            "start": {
              "line": 20,
              "col": 21,
              "offset": 876
            },
            "end": {
              "line": 20,
              "col": 24,
              "offset": 879
            },
            "abstract_content": "log"
          },
          "$STR": {
            "start": {
              "line": 20,
              "col": 25,
              "offset": 880
            },
            "end": {
              "line": 20,
              "col": 68,
              "offset": 923
            },
            "abstract_content": "`[key??JsonLogger.DEFAULT_LOG_KEY]:   "
          },
          "$PARAM": {
            "start": {
              "line": 20,
              "col": 71,
              "offset": 926
            },
            "end": {
              "line": 20,
              "col": 81,
              "offset": 936
            },
            "abstract_content": "`Bad Input"
          }
        },
        "message": "Detected string concatenation with a non-literal variable in a util.format / console.log function. If an attacker injects a format specifier in the string, it will forge the log message. Try to use constant values for the format string.",
        "metadata": {
          "cwe": [
            "CWE-134: Use of Externally-Controlled Format String"
          ],
          "owasp": [
            "A01:2021 - Broken Access Control"
          ],
          "category": "security",
          "technology": [
            "javascript"
          ],
          "subcategory": [
            "audit"
          ],
          "likelihood": "MEDIUM",
          "impact": "LOW",
          "confidence": "LOW",
          "references": [
            "https://cwe.mitre.org/data/definitions/134.html"
          ],
          "license": "Semgrep Rules License v1.0. For more details, visit semgrep.dev/legal/rules-license",
          "vulnerability_class": [
            "Improper Validation"
          ],
          "source": "https://semgrep.dev/r/javascript.lang.security.audit.unsafe-formatstring.unsafe-formatstring",
          "shortlink": "https://sg.run/7Y5R",
          "semgrep.dev": {
            "rule": {
              "origin": "community",
              "r_id": 13582,
              "rule_id": "ReU3OJ",
              "rv_id": 945885,
              "url": "https://semgrep.dev/playground/r/1QToKA3/javascript.lang.security.audit.unsafe-formatstring.unsafe-formatstring",
              "version_id": "1QToKA3"
            }
          }
        },
        "severity": "INFO",
        "fingerprint": "9b60ec4e0b01d188d09de2c95c35389ff1a8642ed723adbd2a4367f1896eee7f04edbfe4cc8cd6ed2d22db6d843f61a81a3e44076a0c433ebb966b0f19aaf0b5_0",
        "lines": "            console.log(`[${key ?? JsonLogger.DEFAULT_LOG_KEY}]:   `, `Bad Input`);",
        "is_ignored": false,
        "validation_state": "NO_VALIDATOR",
        "dataflow_trace": {
          "taint_source": [
            "CliLoc",
            [
              {
                "path": "src/server/utils/JsonLogger.ts",
                "start": {
                  "line": 20,
                  "col": 25,
                  "offset": 880
                },
                "end": {
                  "line": 20,
                  "col": 68,
                  "offset": 923
                }
              },
              "`[${key ?? JsonLogger.DEFAULT_LOG_KEY}]:   "
            ]
          ],
          "intermediate_vars": [],
          "taint_sink": [
            "CliLoc",
            [
              {
                "path": "src/server/utils/JsonLogger.ts",
                "start": {
                  "line": 20,
                  "col": 25,
                  "offset": 880
                },
                "end": {
                  "line": 20,
                  "col": 68,
                  "offset": 923
                }
              },
              "`[${key ?? JsonLogger.DEFAULT_LOG_KEY}]:   "
            ]
          ]
        },
        "engine_kind": "OSS"
      }
    }
  ],
  "errors": [],
  "paths": {
    "scanned": [
      "RouterClient.ts",
      "RouterClientAuthentication.ts",
      "RouterClientLogger.ts",
      "ServerClient.ts",
      "src/index.ts",
      "src/server/ai/IInstructionsBuilder.ts",
      "src/server/ai/OpenAiTransformUtils.ts",
      "src/server/ai/assistants/Assistant.ts.ts",
      "src/server/ai/assistants/ChatAssistant.ts",
      "src/server/ai/assistants/ExercisesAssistant.ts",
      "src/server/ai/assistants/IAssistant.ts",
      "src/server/ai/assistants/ImageAssistant.ts",
      "src/server/ai/assistants/ScheduleAssistant.ts",
      "src/server/ai/assistants/UserThreadContextInstructionsBuilder.ts",
      "src/server/ai/assistants/types.ts",
      "src/server/ai/messages/IMessageInstructionsBuilder.ts",
      "src/server/ai/messages/RunGenerateHomeImageInstructionsBuilder.ts",
      "src/server/ai/messages/RunSendMessageInstructiosBuilder.ts",
      "src/server/ai/runs/GenerateExerciseInstructionsBuilder.ts",
      "src/server/ai/runs/IRunInstructionsBuilder.ts",
      "src/server/ai/runs/RunExamples.ts",
      "src/server/ai/threads/GenerateDayScheduleInstructionsBuilder.ts",
      "src/server/ai/threads/GenerateUserHomeImage.ts",
      "src/server/ai/threads/GenerateWeeklyScheduleInstructionsBuilder.ts",
      "src/server/ai/threads/IThreadInstructionsBuilder.ts",
      "src/server/api/HttpClient.ts",
      "src/server/api/OpenAiClient.ts",
      "src/server/api/UserRepository.ts",
      "src/server/api/interfaces/IOpenAiClient.ts",
      "src/server/api/types.ts",
      "src/server/api/utils/HttpRequestUtils.ts",
      "src/server/api/utils/HttpResponseUtils.ts",
      "src/server/controllers/getUserChatMessages.ts",
      "src/server/controllers/getUserSchedule.ts",
      "src/server/controllers/postFeedback.ts",
      "src/server/controllers/postGenerateDaySchedule.ts",
      "src/server/controllers/postGenerateExercise.ts",
      "src/server/controllers/postGenerateHomeImage.ts",
      "src/server/controllers/postGenerateSchedule.ts",
      "src/server/controllers/postUserChatMessage.ts",
      "src/server/controllers/signup.ts",
      "src/server/database/RealTimeDatabaseClient.ts",
      "src/server/database/models/UserFeedbackEntry.ts",
      "src/server/utils/JsonLogger.ts",
      "src/types/dog.ts"
    ],
    "skipped": [
      {
        "path": "src/server/ai/threads/_example_GenerateWeeklyScheduleInstructionsBuilder",
        "reason": "cli_include_flags_do_not_match"
      }
    ]
  },
  "interfile_languages_used": [],
  "skipped_rules": []
}
