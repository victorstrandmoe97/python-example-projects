rules:
- id: path-join-resolve-traversal
  message: |
    Possible writing outside of the destination,
    make sure that the target path is nested in the intended destination
  metadata:
    owasp: 'A01:2021 Broken Access Control'
    cwe: 
      - 'CWE-22: Improper Limitation of a Pathname to a Restricted Directory (Path Traversal)'
    category: security
  severity: WARNING
  languages:
    - javascript
    - typescript
  patterns:
    - pattern-inside: |
        ...
        const $PATH = require('path');
        ...
    - pattern-either:
        - pattern: $PATH.join(...,$INPUT,...)
        - pattern: $PATH.join(...,$INPUT.$FOO,...)
        - pattern: $PATH.join(...,$INPUT.$FOO.$BAR,...)
        - pattern: $PATH.resolve(...,$INPUT,...)
        - pattern: $PATH.resolve(...,$INPUT.$FOO,...)
        - pattern: $PATH.resolve(...,$INPUT.$FOO.$BAR,...)
        - pattern: |
            $VAR = $INPUT;
            ...
            $PATH.join(...,$VAR,...)
        - pattern: |
            $VAR = $INPUT.$FOO;
            ...
            $PATH.join(...,$VAR,...)
        - pattern: |
            $VAR = $INPUT.$FOO.$BAR;
            ...
            $PATH.join(...,$VAR,...)
        - pattern: |
            $VAR = $INPUT;
            ...
            $PATH.resolve(...,$VAR,...)
        - pattern: |
            $VAR = $INPUT.$FOO;
            ...
            $PATH.resolve(...,$VAR,...)
        - pattern: |
            $VAR = $INPUT.$FOO.$BAR;
            ...
            $PATH.resolve(...,$VAR,...)
