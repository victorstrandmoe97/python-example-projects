rules:
  - id: sequelize-weak-tls-version
    message: >
      TLS1.0 and TLS1.1 are deprecated and should not be used anymore.
      By default, NodeJS uses TLSv1.2.
      TLS min version must not be downgraded to TLS1.0 or TLS1.1.
      Enforcing TLS1.3 is highly recommended.
      This rule checks TLS configuration for Postgresql, MariaDB, and
      MySQL. SQLite is not concerned by TLS configuration.
      This rule could be extended for MSSQL, but the dialectOptions
      is specific for Tedious.
    metadata:
      cwe: 
        - "CWE-326: Inadequate Encryption Strength"
      owasp: "A06:2021 - Security Misconfiguration"
      references:
        - https://node-postgres.com/features/ssl
        - https://nodejs.org/api/tls.html#tls_class_tls_tlssocket
        - https://nodejs.org/api/tls.html#tls_tls_createsecurecontext_options
        - https://nodejs.org/api/tls.html#tls_tls_default_min_version
      category: security
      technology:
        - sequelize
    severity: WARNING
    languages:
      - javascript
      - typescript
    patterns:
      - pattern-inside: |
          {
            host: $HOST,
            database: $DATABASE,
            dialect: $DIALECT,
            dialectOptions:
              { ssl: { minVersion: $VERSION, ... } }
          }
      - pattern-either:
          - pattern: "minVersion: 'TLSv1'"
          - pattern: "minVersion: 'TLSv1.1'"
      - metavariable-regex:
          metavariable: $DIALECT
          regex: "['\"](mariadb|mysql|postgres)['\"]"
